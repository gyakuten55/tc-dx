# 株式会社ティーシー 業務管理システム

配管事業のための統合業務管理システムです。取引先、作業員、サービスのマスター管理、案件登録、業務指示書作成、統計情報表示などの機能を備えています。

## 主な機能

### マスター管理
- **取引先マスター管理**：取引先の情報登録、検索、編集、削除
- **作業員マスター管理**：作業員の情報登録、検索、編集、削除（緊急連絡先などの個人情報管理）
- **サービスマスター管理**：サービス項目の登録、検索、編集、削除

### 案件管理
- **案件登録**：取引先、サービス、価格、作業員、作業内容などの登録
- **案件検索**：複数条件での案件検索（取引先、サービス、期間、ステータス）
- **案件ステータス管理**：作業前、作業中、完了、キャンセル
- **トラブル案件管理**：案件のトラブル情報記録（担当者指定可能）
- **写真管理**：案件ごとの写真登録、一覧表示、エクスポート機能

### 業務指示書
- **業務指示書作成**：案件情報から業務指示書を作成
- **PDF出力**：業務指示書のPDF出力
- **印刷機能**：業務指示書の印刷

### 統計情報
- **前年度比較**：選択した年度と比較年度の月次売上比較グラフ、目標ラインとの比較
- **トラブル統計**：作業員別・取引先別のトラブル率、案件数、並び替え機能
- **価格統計**：平均単価、最小単価、最大単価、合計金額、案件数
- **サービス別売上**：サービスごとの売上金額の棒グラフ

### セキュリティ
- **ユーザー認証**：ログインID・パスワードによるアクセス制限
- **権限管理**：管理者権限と一般ユーザー権限の区別

## インストール方法

1. このプロジェクトをダウンロードまたはクローンします
2. 以下のコマンドを実行してパッケージをインストールします：

```
pip install -r requirements.txt
```

3. アプリケーションを起動します：

```
python main.py
```

## フォントのセットアップ

業務指示書のPDF生成のために、IPAexフォントが必要です。以下の手順でセットアップしてください：

1. [IPAexフォント](https://moji.or.jp/ipafont/ipaex00401/)をダウンロードします
2. ダウンロードしたZIPファイルを解凍します
3. `ipaexg.ttf`（IPAexゴシック）ファイルを取り出します
4. プロジェクトの`fonts`ディレクトリに`ipaexg.ttf`を配置します

フォントファイルがない場合、システムは代替フォントとしてHelveticaを使用しますが、日本語が正しく表示されない場合があります。

## 操作方法

### ログイン
初期設定では以下のユーザーが登録されています：
- 管理者：ID `0001` パスワード `001`
- 一般ユーザー：ID `0002`〜`0005` パスワード `002`〜`005`

### マスター管理
1. タブから該当する管理画面を選択します（取引先、作業員、サービス）
2. 「追加」ボタンで新規登録、「編集」ボタンで選択項目の編集、「削除」ボタンで選択項目の削除ができます
3. 検索バーを使用して、名称で絞り込み検索ができます

### 案件管理
1. 「案件管理」タブで案件一覧を表示できます
2. 「追加」ボタンで新規案件を登録、「編集」ボタンで選択案件の編集、「削除」ボタンで選択案件の削除ができます
3. 各種フィルタを組み合わせて案件を絞り込めます（取引先、サービス、状態、期間など）
4. 写真は案件編集画面から追加・管理できます

### 業務指示書
1. 案件管理で案件を選択し「編集」をクリックすると案件編集画面が開きます
2. 「業務指示書」ボタンをクリックすると業務指示書作成ダイアログが表示されます
3. 必要情報を入力し「プレビュー」で内容確認、「PDF保存」でファイル保存、「印刷」で印刷できます
4. 「DB保存」でデータベースに業務指示書情報を保存できます
5. 「業務指示書」タブでは保存した業務指示書の一覧表示、検索、編集、削除ができます

### 統計情報
1. 「統計情報」タブでは4種類の統計情報を確認できます
   - **前年度比較**：対象年度と比較年度を選択し、月別売上の推移を比較できます。目標金額も設定可能です。
   - **トラブル統計**：作業員別・取引先別のトラブル率を確認できます。各項目をクリックすると並び替えが可能です。
   - **価格統計**：選択した年度の価格に関する統計情報を表示します。
   - **サービス別売上**：選択した年度のサービスごとの売上を棒グラフで表示します。

## 実行ファイル（.exe）の作成方法

以下のコマンドを実行して実行ファイルを作成します：

```
pyinstaller --onefile --windowed --icon=resources/icon.ico main.py
```

実行ファイルは `dist` フォルダ内に作成されます。

## 依存パッケージ

- PyQt6 6.5.0 - GUIフレームワーク
- matplotlib 3.7.1 - グラフ描画
- pandas 1.5.3 - データ処理
- openpyxl 3.1.2 - Excelファイル処理
- sqlite3worker 1.1.7 - SQLiteデータベース操作
- reportlab 3.6.12 - PDF生成
- Pillow 9.5.0 - 画像処理
- pyinstaller 5.13.0 - 実行ファイル作成

## 技術仕様

- 言語：Python 3.13
- データベース：SQLite
- GUI：PyQt6
- PDF生成：ReportLab

## サポート

ご質問やサポートが必要な場合は、株式会社ティーシーまでお問い合わせください。

## 開発元

株式会社ティーシー 

## 修正内容（2025年5月）

### 指示書関連の修正
- その他注意事項、水質検査のチェックボックスは印刷後手書きで記入するため、チェックボックスは残しながら指示書印刷時にはチェック状態を表示しないよう修正
- 照合事項セクションを指示書印刷から削除
- 水質検査チェック項目の右側に項目数が表示されるよう修正
- 採水場所の項目の隣に「水質：あり・なし」の選択肢を追加

### 統計情報関連の修正
- 月間売上目標設定機能を追加
- 各月で目標金額が設定できるように修正
- 年間売上目標も設定できるよう修正
- 売上目標設定タブを追加し、すべての目標設定を一箇所で管理できるよう改善

### ユーザー情報関連の修正
- 不要なログインユーザー情報を削除
- 以下のログインユーザー情報を設定
  - ID: 0001、パスワード: 0526、権限：マスター権限（すべてにアクセス可能）
  - ID: 0002、パスワード: 002、権限：案件管理・指示書作成機能のみアクセス可能 